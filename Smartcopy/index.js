(function(u,d,p,i,h,f){"use strict";const{FormSection:m,FormRow:b}=f.Forms,{View:w}=f.General,C=d.findByProps("getChannelId"),_=d.findByProps("getChannelId","getVoiceChannelId"),v=d.findByProps("setString"),o=/```([\s\S]+?)```/;function I(c){const r=[],a=Object.keys(d.modules);for(const t of a){const e=d.modules[t]?.publicModule?.exports;e&&e.getMessages&&typeof e.getMessages=="function"?r.push(e):e&&e.default&&e.default.getMessages&&typeof e.default.getMessages=="function"&&r.push(e.default)}for(const t of r)try{const e=t.getMessages(c);if(e&&(e._array||e.length>0||e.size&&e.size>0))return t}catch{}return null}function y(){try{const c=C?.getChannelId()||_?.getChannelId();if(!c)return i.showToast("Error: No Channel ID found.","ic_warning");const r=I(c);if(!r)return i.showToast("Fatal: Could not find a working MessageStore.","ic_warning");const a=r.getMessages(c);let t=[];if(Array.isArray(a)?t=a:a._array?t=a._array:typeof a.toArray=="function"?t=a.toArray():t=Object.values(a),!t||t.length===0)return i.showToast("Chat seems empty (or store failed).","ic_warning");const e=t.slice().reverse().find(function(n){return n.content&&o.test(n.content)?!0:n.embeds&&n.embeds.length>0?n.embeds.some(function(s){return s.description&&o.test(s.description)?!0:s.fields?s.fields.some(function(l){return l.value&&o.test(l.value)}):!1}):!1});if(e){let n="";e.content&&o.test(e.content)?n=e.content.match(o)[1]:e.embeds&&e.embeds.forEach(function(s){s.description&&o.test(s.description)?n=s.description.match(o)[1]:s.fields&&s.fields.forEach(function(l){l.value&&o.test(l.value)&&(n=l.value.match(o)[1])})}),n?(v.setString(n.trim()),i.showToast("Copied to Clipboard!",h.getAssetIDByName("ic_check"))):i.showToast("Extraction failed.","ic_warning")}else i.showToast("No code blocks found recently.","ic_warning")}catch(c){console.error(c),i.showToast(`Crash: ${c.message}`,"ic_warning")}}let g;var M={onLoad:function(){try{g=p.registerCommand({name:"copycode",displayName:"copycode",description:"Copy the last codeblock",displayDescription:"Copy the last codeblock",options:[],applicationId:"-1",inputType:1,type:1,execute:y})}catch{}},onUnload:function(){g&&g()},settings:function(){return React.createElement(w,{style:{flex:1}},React.createElement(m,{title:"Manual Action"},React.createElement(b,{label:"Scan & Copy Last Code",subLabel:"Tap to find and copy the last codeblock in this chat.",leading:React.createElement(f.General.Image,{source:h.getAssetIDByName("ic_copy_message_link"),style:{width:24,height:24}}),onPress:function(){return y()}})))}};return u.default=M,Object.defineProperty(u,"__esModule",{value:!0}),u})({},vendetta.metro,vendetta.commands,vendetta.ui.toasts,vendetta.ui.assets,vendetta.ui.components);
