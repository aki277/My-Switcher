(function(l,s,y,o,g,d){"use strict";const{FormSection:m,FormRow:f}=d.Forms,{View:b}=d.General,w=s.findByProps("getMessages","getMessage"),C=s.findByProps("getChannelId"),v=s.findByProps("getChannelId","getVoiceChannelId"),I=s.findByProps("setString"),n=/```([\s\S]+?)```/;function p(){try{const a=C?.getChannelId()||v?.getChannelId();if(!a){o.showToast("Error: Could not find Channel ID.","ic_warning");return}const r=w.getMessages(a);if(!r){o.showToast("Error: Could not read messages.","ic_warning");return}const h=r.toArray?r.toArray():Object.values(r);if(!h||h.length===0){o.showToast("Chat appears empty.","ic_warning");return}const i=h.reverse().find(function(e){return e.content&&n.test(e.content)?!0:e.embeds&&e.embeds.length>0?e.embeds.some(function(t){return t.description&&n.test(t.description)?!0:t.fields?t.fields.some(function(c){return c.value&&n.test(c.value)}):!1}):!1});if(i){let e="";i.content&&n.test(i.content)?e=i.content.match(n)[1]:i.embeds&&i.embeds.forEach(function(t){t.description&&n.test(t.description)?e=t.description.match(n)[1]:t.fields&&t.fields.forEach(function(c){c.value&&n.test(c.value)&&(e=c.value.match(n)[1])})}),e?(I.setString(e.trim()),o.showToast("Copied to Clipboard!",g.getAssetIDByName("ic_check"))):o.showToast("Found block but failed to extract.","ic_warning")}else o.showToast("No code blocks found in recent messages.","ic_warning")}catch(a){console.error(a),o.showToast(`Crash: ${a.message}`,"ic_warning")}}let u;var _={onLoad:function(){try{u=y.registerCommand({name:"copycode",displayName:"copycode",description:"Copy the last codeblock",displayDescription:"Copy the last codeblock",options:[],applicationId:"-1",inputType:1,type:1,execute:p})}catch(a){console.error("Failed to register command",a)}},onUnload:function(){u&&u()},settings:function(){return React.createElement(b,{style:{flex:1}},React.createElement(m,{title:"Manual Trigger"},React.createElement(f,{label:"Scan Chat & Copy Code",subLabel:"Tap this if the slash command fails",leading:React.createElement(d.General.Image,{source:g.getAssetIDByName("ic_copy_message_link"),style:{width:24,height:24}}),onPress:function(){return p()}})),React.createElement(m,{title:"Info"},React.createElement(f,{label:"How to use",subLabel:"1. Go to a channel with code.\\n2. Come here and tap the button above.\\n3. Or try typing /copycode"})))}};return l.default=_,Object.defineProperty(l,"__esModule",{value:!0}),l})({},vendetta.metro,vendetta.commands,vendetta.ui.toasts,vendetta.ui.assets,vendetta.ui.components);
