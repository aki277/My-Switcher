(function(h,u,f,i,y,m,t){"use strict";const{FormSection:b,FormRow:p,FormSwitch:w}=m.Forms,{View:v}=m.General,E=u.findByProps("getChannelId"),A=u.findByProps("getChannelId","getVoiceChannelId"),T=u.findByProps("setString"),R=u.findByProps("subscribe","dispatch"),S=u.findByProps("getUser"),d=/```([\s\S]+?)```/;function _(r){const a=Object.keys(u.modules),e=[];for(const o of a){const s=u.modules[o]?.publicModule?.exports;s&&s.getMessages?e.push(s):s&&s.default&&s.default.getMessages&&e.push(s.default)}for(const o of e)try{const s=o.getMessages(r);if(s&&(s._array||s.length>0||s.size>0))return o}catch{}return null}function I(r,a){try{if(t.storage.targets&&t.storage.targets.length>0&&a&&!t.storage.targets.includes(a))return"IGNORED";const e=_(r);if(!e)return"NO_STORE";const o=e.getMessages(r);let s=[];if(Array.isArray(o)?s=o:o._array?s=o._array:typeof o.toArray=="function"?s=o.toArray():s=Object.values(o),!s||s.length===0)return"EMPTY";const l=s.slice().reverse().find(function(c){return c.content&&d.test(c.content)?!0:c.embeds&&c.embeds.length>0?c.embeds.some(function(n){return n.description&&d.test(n.description)||n.fields&&n.fields.some(function(C){return C.value&&d.test(C.value)})}):!1});if(l){let c="";if(l.content&&d.test(l.content))c=l.content.match(d)[1];else if(l.embeds){const n=JSON.stringify(l.embeds).match(d);n&&(c=n[1])}if(c){const n=c.trim();return t.storage.lastCopied===n?"DUPLICATE":(T.setString(n),t.storage.lastCopied=n,"SUCCESS")}}return"NO_CODE"}catch(e){return console.error(e),"ERROR"}}let g=[];var L={onLoad:function(){typeof t.storage.autoCopy>"u"&&(t.storage.autoCopy=!0),t.storage.targets||(t.storage.targets=[]),g.push(f.registerCommand({name:"autocopy add",displayName:"autocopy add",description:"Add a bot/user to the watchlist",displayDescription:"Add a bot/user to the watchlist",options:[{name:"user",description:"The bot to watch",type:6,required:!0}],applicationId:"-1",inputType:1,type:1,execute:function(a){const e=a[0].value;t.storage.targets.includes(e)?i.showToast("Already in watchlist.","ic_warning"):(t.storage.targets.push(e),i.showToast("Added to watchlist!",y.getAssetIDByName("ic_check")))}})),g.push(f.registerCommand({name:"autocopy remove",displayName:"autocopy remove",description:"Remove a bot from watchlist",displayDescription:"Remove a bot from watchlist",options:[{name:"user",description:"The bot to remove",type:6,required:!0}],applicationId:"-1",inputType:1,type:1,execute:function(a){const e=a[0].value,o=t.storage.targets.indexOf(e);o>-1?(t.storage.targets.splice(o,1),i.showToast("Removed from watchlist.",y.getAssetIDByName("ic_trash"))):i.showToast("User not found in list.","ic_warning")}})),g.push(f.registerCommand({name:"autocopy list",displayName:"autocopy list",description:"See who you are watching",displayDescription:"See who you are watching",options:[],applicationId:"-1",inputType:1,type:1,execute:function(){if(t.storage.targets.length===0)i.showToast("List empty (Copying ALL code)","ic_info");else{const a=t.storage.targets.map(function(e){const o=S.getUser(e);return o?o.username:e}).join(", ");i.showToast(`Watching: ${a}`)}}}));const r=R.subscribe("MESSAGE_CREATE",function(a){if(!t.storage.autoCopy)return;const e=E?.getChannelId()||A?.getChannelId();if(a.channelId!==e&&a.message?.channel_id!==e)return;const o=a.message?.author?.id;setTimeout(function(){I(e,o)==="SUCCESS"&&i.showToast("Auto-Copied!",y.getAssetIDByName("ic_check"))},500)});g.push(r)},onUnload:function(){for(const r of g)r()},settings:function(){const[r,a]=React.useState(t.storage.autoCopy);return React.createElement(v,{style:{flex:1}},React.createElement(b,{title:"Master Switch"},React.createElement(p,{label:"Auto-Copy Enabled",subLabel:t.storage.targets.length>0?"Targeting specific bots only.":"Copying ALL codeblocks (No targets set).",control:React.createElement(w,{value:r,onValueChange:function(e){t.storage.autoCopy=e,a(e)}})})),React.createElement(b,{title:"Watchlist Management"},React.createElement(p,{label:"Manage via Chat",subLabel:"Use /autocopy add @User to target a specific bot."}),React.createElement(p,{label:"Clear Watchlist",subLabel:`Currently watching ${t.storage.targets.length} users.`,onPress:function(){t.storage.targets=[],i.showToast("List cleared (Copying ALL)")}})))}};return h.default=L,Object.defineProperty(h,"__esModule",{value:!0}),h})({},vendetta.metro,vendetta.commands,vendetta.ui.toasts,vendetta.ui.assets,vendetta.ui.components,vendetta.plugin);
